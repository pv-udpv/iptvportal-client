# IPTVPortal Client - Workspace Rules

## Project Management
- **Package Manager**: This project uses `uv` as the Python package manager
- **Virtual Environment**: `uv` automatically manages virtual environments
- **Dependencies**: All dependencies are managed through `uv.lock`
- **Python Version**: Managed by `uv` (see `pyproject.toml`)

## Command Execution
All commands must use `uv run` prefix for proper environment isolation:

```bash
# Running tests
uv run pytest

# Running specific test files
uv run pytest tests/test_sync_config.py

# Running with coverage
uv run pytest --cov=src/iptvportal/sync --cov-report=html

# Running the CLI
uv run python -m iptvportal.cli --help

# Running sync commands
uv run python -m iptvportal.cli sync --help

# Adding dependencies
uv add pytest-asyncio pytest-mock

# Installing in development mode
uv sync

# Running linters/formatters
uv run ruff check .
uv run ruff format .
```

## Development Workflow
1. **Setup**: `uv sync` to install dependencies
2. **Testing**: `uv run pytest` to run all tests
3. **Linting**: `uv run ruff check .` and `uv run ruff format .`
4. **CLI Testing**: `uv run python -m iptvportal.cli [command]`
5. **Adding Packages**: `uv add [package]` for new dependencies

## Testing Guidelines
- All tests must be runnable with `uv run pytest`
- Use `pytest-asyncio` for async tests
- Mock external dependencies (API calls, database connections)
- Test files should be in `tests/` directory
- Use descriptive test names and docstrings
- Aim for >90% coverage on new code

## Code Quality
- Use `uv run ruff` for linting and formatting
- Follow existing code patterns and naming conventions
- Add type hints for new functions
- Write comprehensive docstrings
- Use async/await for I/O operations

## File Structure
- Source code in `src/iptvportal/`
- Tests in `tests/`
- Configuration in `config/`
- Documentation in `docs/`
- Use `uv run` for all executable commands

## Git Workflow
- **Automated Workflow**: Use `./scripts/git-workflow.sh` for complete commit → test → push → PR workflow
- **Conventional Commits**: All commits must follow `type(scope): description` format
- **Git Hooks**: Automatic quality checks via `.githooks/` (setup with `./scripts/setup-hooks.sh`)
- **Branch Naming**: Use `issue-123-feature-name` for issue-related branches
- **PR Creation**: Use `./scripts/create-pr.sh` with automatic issue linking
- **Quality Gates**: Pre-commit hooks enforce linting, formatting, and testing

### Workflow Scripts
```bash
# One-time setup
chmod +x scripts/*.sh
./scripts/setup-hooks.sh

# Daily workflow
./scripts/git-workflow.sh                    # Full automated workflow
./scripts/commit-helper.sh                   # Interactive commit builder
./scripts/create-pr.sh --issue 123           # Create PR with issue link
./scripts/issue-branch.sh 456                # Create branch from issue
./scripts/validate-commit.sh --all           # Validate commit messages
```

### Conventional Commit Format
```
type(scope): description

# Types: feat, fix, docs, test, refactor, chore, perf, style, ci, revert, build
# Scopes: sync, cli, transpiler, schema, cache, config, docs, test, ci, deps
# Examples:
feat(sync): Add incremental sync strategy
fix(cli): Handle invalid command arguments
test(schema): Add validation tests
```

### Git Hooks (Automatic)
- **pre-commit**: Linting, formatting, quick tests, debug statement detection
- **commit-msg**: Message format validation, issue reference suggestions
- **post-commit**: Helpful suggestions, PR creation offers, status updates
- **pre-push**: Full test suite, coverage check, main branch protection

**Skip hooks**: Use `--no-verify` flag (e.g., `git commit --no-verify`)

## Makefile Commands
- **Build System**: Comprehensive Makefile with uv integration for all development tasks
- **Help**: Run `make` or `make help` to see all available commands with descriptions

### Installation & Setup:
```bash
make install      # Production dependencies only
make install-dev  # All dependencies including dev
make sync         # Sync production dependencies
make sync-dev     # Sync all dependencies
make dev          # Set up development environment
```

### Testing:
```bash
make test                    # Run all tests
make test-cov               # Tests with coverage report
make test-verbose           # Verbose test output
make test-specific TEST=file.py  # Run specific test file
make test-watch             # Tests in watch mode
```

### Code Quality:
```bash
make lint         # Run ruff linter
make lint-fix     # Linter with auto-fix
make format       # Format code with ruff
make format-check # Check formatting without changes
make type-check   # Run mypy type checker
make check        # Run all checks (lint, format, type)
make check-fix    # Run checks with auto-fix
```

### CLI Shortcuts:
```bash
make cli ARGS="command args"  # Run CLI with arguments
make cli-help                 # Show CLI help
make cli-auth                 # Authenticate
make cli-sync-init           # Initialize sync
make cli-sync-pull           # Pull data
make cli-sync-status         # Show sync status
```

### Development Workflows:
```bash
make quick        # Fast feedback (lint-fix + tests)
make pre-commit   # Full pre-commit checks
make ci           # CI-style checks (no auto-fix)
```

### Utilities:
```bash
make clean        # Remove cache/build artifacts
make build        # Build distribution packages
make shell        # Start IPython shell
make cache-clear  # Clear all caches
make info         # Show project information
make version      # Show project version
```

### Workflow Integration:
- Makefile commands integrate with git hooks and workflow scripts
- All commands use `uv run` for proper environment isolation
- Color-coded output for better readability
- Comprehensive help system with target descriptions

## Important Notes
- Never use `pip` directly - always use `uv add` or `uv sync`
- Never use `python` directly - always use `uv run python`
- All scripts and tools should work with `uv run`
- Virtual environment is managed automatically by `uv`
- Use `make` commands for all development operations
